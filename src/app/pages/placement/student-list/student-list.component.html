<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Student Placement Forms</h5>
                <p class="card-title-desc mb-0">List of all student placement forms</p>
            </div>

            <div class="card-body">
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="text-left">#</th>
                                <th class="text-center">Student Name</th>
                                <th class="text-center">Email</th>
                                <th class="text-center">Applied Role</th>
                                <th class="text-center">Institute</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr *ngFor="let c of paginateData; let i = index; trackBy: trackById">
                                <td class="text-left">{{ (page - 1) * pageSize + i + 1 }}</td>
                                <td class="text-center">{{ c.name }}</td>
                                <td class="text-center">{{ c.email }}</td>
                                <td class="text-center">{{ c.appliedrole }}</td>
                                <td class="text-center">{{ c.institute }}</td>
                                <td class="text-end">
                                    <div class="d-flex justify-content-end gap-1">
                                        <button type="button" class="btn btn-soft-primary waves-effect waves-light"
                                            title="Preview" (click)="openPreviewModal(exlargeModal, c.id)">
                                            <i class="bx bx-show font-size-16 align-middle"></i>
                                        </button>

                                        <button type="button" class="btn btn-soft-danger waves-effect waves-light"
                                            title="Delete" (click)="deletePlacementForm(c.id)">
                                            <i class="bx bx-trash-alt font-size-16 align-middle"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="row mt-4">
                    <ngb-pagination [collectionSize]="collectionSize" [pageSize]="pageSize" [(page)]="page"
                        [maxSize]="5" [rotate]="true" [ellipses]="false" [boundaryLinks]="true"
                        (pageChange)="getPagination()"
                        class="d-flex justify-content-end pagination-rounded-flat pagination-success">
                    </ngb-pagination>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<ng-template #exlargeModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Placement Form Details</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
    </div>

    <div class="modal-body">
        <!-- Loading state -->
        <div *ngIf="isLoadingPreview" class="d-flex align-items-center justify-content-center py-5">
            <div class="spinner-border" role="status" aria-hidden="true"></div>
            <span class="ms-2">Loading...</span>
        </div>

        <div *ngIf="!isLoadingPreview && selectedForm" class="row g-4">
            <!-- Details -->
            <div class="col-12 col-xl-5">
                <h5 class="mb-3">{{ selectedForm.firstname }} {{ selectedForm.lastname }}</h5>
                <div class="small text-muted mb-2">ID: {{ selectedForm.studentid || 'N/A' }}</div>

                <div class="mb-2"><strong>Email:</strong> {{ selectedForm.email }}</div>
                <div class="mb-2"><strong>Contact Number:</strong> {{ selectedForm.contactnumber }}</div>
                <div class="mb-2"><strong>Institute:</strong> {{ selectedForm.institute }}</div>
                <div class="mb-2"><strong>Passing Year:</strong> {{ selectedForm.passingyear }}</div>
                <div class="mb-2"><strong>Applied Role:</strong> {{ selectedForm.appliedrole }}</div>
                <div class="mb-2"><strong>Experience:</strong> {{ selectedForm.experience }}</div>

                <div class="mb-2">
                    <strong>Portfolio URL:</strong>
                    <a *ngIf="selectedForm.portfoliourl" [href]="selectedForm.portfoliourl" target="_blank"
                        rel="noopener">
                        {{ selectedForm.portfoliourl }}
                    </a>
                    <span *ngIf="!selectedForm.portfoliourl">N/A</span>
                </div>

                <div class="mb-2"><strong>About:</strong> {{ selectedForm.about || 'N/A' }}</div>

                <div class="mb-2">
                    <strong>Created Date:</strong> {{ selectedForm.createddate | date:'medium' }}
                </div>
                <div class="mb-2">
                    <strong>Updated Date:</strong>
                    {{ selectedForm.updateddate ? (selectedForm.updateddate | date:'medium') : 'N/A' }}
                </div>

                <div class="d-flex gap-2 mt-3" *ngIf="selectedForm.resume">
                    <a class="btn btn-primary btn-sm" [href]="selectedForm.resume" target="_blank" rel="noopener">
                        Open Resume in New Tab
                    </a>
                    <a class="btn btn-outline-primary btn-sm" [href]="selectedForm.resume" download>
                        Download Resume
                    </a>
                </div>
            </div>

            <!-- PDF Preview -->
            <div class="col-12 col-xl-7">
                <div class="border rounded" style="height:70vh; overflow:hidden;">
                    <ng-container *ngIf="safeResumeUrl; else noResume">
                        <!-- Try object first (often best for PDFs) -->
                        <object [data]="safeResumeUrl" type="application/pdf" width="100%" height="100%">
                            <!-- Fallback: iframe -->
                            <iframe [src]="safeResumeUrl" width="100%" height="100%" style="border:0;"></iframe>
                        </object>
                    </ng-container>
                    <ng-template #noResume>
                        <div class="h-100 d-flex align-items-center justify-content-center text-muted">
                            No resume available to preview.
                        </div>
                    </ng-template>
                </div>
                <div class="small text-muted mt-2">
                    If the preview doesn’t load, click “Open Resume in New Tab.”
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
    </div>
</ng-template>