<div class="row" *ngIf="isOpen">
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div *ngIf="!isUpdate">
                    <h5 class="card-title mb-0">Add Testimonial</h5>
                    <p class="card-title-desc">Enter testimonial details below</p>
                </div>
                <div *ngIf="isUpdate">
                    <h5 class="card-title mb-0">Update Testimonial</h5>
                    <p class="card-title-desc">Modify testimonial details below</p>
                </div>
                <button type="button" class="btn btn-danger waves-effect waves-light" (click)="closeTestimonialForm()">
                    <i class="bx bx-arrow-back"></i>
                    Back
                </button>
            </div>
        </div>

        <div class="card-body">
            <form [formGroup]="testimonialForm" novalidate>
                <!-- Name -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" formControlName="name" placeholder="Enter person name"
                            [ngClass]="{
                'is-invalid': f.name.invalid && f.name.touched
              }" (blur)="f.name.markAsTouched()" (input)="f.name.markAsTouched()" />
                        <div class="invalid-feedback" *ngIf="f.name.invalid && f.name.touched">
                            Name is required.
                        </div>
                    </div>
                </div>

                <!-- Rating -->
                <div class="mb-3">
                    <label class="form-label">Rating <span class="text-danger">*</span></label>
                    <div class="d-flex gap-1">
                        <button type="button" *ngFor="let star of [1, 2, 3, 4, 5]"
                            class="btn p-0 border-0 bg-transparent fs-3"
                            [ngClass]="star <= rating ? 'text-warning' : 'text-secondary'" (click)="setRating(star)">
                            <i class="mdi mdi-star"></i>
                        </button>
                    </div>
                    <div class="text-danger small mt-1" *ngIf="f.rating.invalid && f.rating.touched">
                        Rating is required.
                    </div>
                </div>

                <!-- Message -->
                <div class="mb-3">
                    <label class="form-label">Message <span class="text-danger">*</span></label>
                    <textarea class="form-control" formControlName="message" rows="4"
                        placeholder="Write your testimonial..." [ngClass]="{
              'is-invalid': f.message.invalid && f.message.touched
            }" (blur)="f.message.markAsTouched()" (input)="f.message.markAsTouched()"></textarea>
                    <div class="invalid-feedback" *ngIf="f.message.invalid && f.message.touched">
                        Message is required.
                    </div>
                </div>

                <!-- Status -->
                <div class="mb-3">
                    <label class="form-label me-3">Status <span class="text-danger">*</span></label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" id="Active" [value]="1"
                            formControlName="isactive" />
                        <label class="form-check-label" for="Active">Active</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" id="statusInactive" [value]="0"
                            formControlName="isactive" />
                        <label class="form-check-label" for="statusInactive">Inactive</label>
                    </div>

                    <div class="text-danger small mt-1" *ngIf="f.isactive.invalid && f.isactive.touched">
                        Please select a status.
                    </div>
                </div>

                <hr class="my-4" />

                <!-- Action Buttons -->
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-primary" [disabled]="testimonialForm.invalid" *ngIf="!isUpdate"
                        (click)="saveTestimonial()">
                        <i class="bx bx-save me-1"></i> Submit
                    </button>

                    <button type="button" class="btn btn-success" [disabled]="testimonialForm.invalid" *ngIf="isUpdate"
                        (click)="saveTestimonial()">
                        <i class="bx bx-sync me-1"></i> Update
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="row" *ngIf="!isOpen">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Testimonial List</h5>
            <button type="button" class="btn btn-primary waves-effect waves-light" (click)="openTestimonialForm()">
                <i class="mdi mdi-plus-circle-outline me-1"></i> Add Testimonial
            </button>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table align-middle table-bordered mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="text-center" style="width: 5%">#</th>
                            <th class="text-start" style="width: 20%">Name</th>
                            <th class="text-center" style="width: 10%">Rating</th>
                            <th class="text-start" style="width: 40%">Message</th>
                            <th class="text-center" style="width: 10%">Status</th>
                            <th class="text-end" style="width: 15%">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let t of paginateData; let i = index">
                            <td class="text-center">{{ (page - 1) * pageSize + i + 1 }}</td>
                            <td class="text-start fw-semibold">{{ t.name }}</td>
                            <td class="text-center">
                                <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                                    <i class="mdi mdi-star"
                                        [ngClass]="star <= t.rating ? 'text-warning' : 'text-muted'">
                                    </i>
                                </ng-container>
                                <span class="ms-1">({{ t.rating || 0 }})</span>
                            </td>
                            <td class="text-start text-truncate" style="max-width: 200px;" title="{{ t.message }}">
                                {{ t.message }}
                            </td>
                            <td class="text-center">
                                <button type="button" class="btn btn-sm"
                                    [ngClass]="t.isactive === 1 ? 'btn-success' : 'btn-secondary'"
                                    (click)="toggleStatus(t)">
                                    {{ t.isactive ? 'Active' : 'Inactive' }}
                                </button>
                            </td>
                            <td class="text-end">
                                <div class="d-flex justify-content-end gap-1">
                                    <button type="button" class="btn btn-soft-primary waves-effect waves-light"
                                        title="View" (click)="openTestimonialView(t, previewModal)">
                                        <i class="fa fa-eye font-size-16 align-middle"></i>
                                    </button>

                                    <button type="button" class="btn btn-soft-primary waves-effect waves-light"
                                        title="Edit" (click)="editTestimonial(t)">
                                        <i class="bx bx-edit font-size-16 align-middle"></i>
                                    </button>

                                    <button type="button" class="btn btn-soft-danger waves-effect waves-light"
                                        title="Delete" (click)="deleteTestimonial(t.id)">
                                        <i class="bx bx-trash-alt font-size-16 align-middle"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <tr *ngIf="!paginateData.length">
                            <td colspan="6" class="text-center text-muted py-3">
                                No testimonials found.
                            </td>
                        </tr>
                    </tbody>

                </table>
            </div>

            <!-- Pagination Placeholder -->
            <div class="row mt-4">
                <ngb-pagination [collectionSize]="collectionSize" [pageSize]="pageSize" [(page)]="page" [maxSize]="5"
                    [rotate]="true" [ellipses]="false" [boundaryLinks]="true" (pageChange)="getPagination()"
                    aria-label="Default pagination"
                    class="d-flex justify-content-end pagination-rounded-flat pagination-success"></ngb-pagination>
            </div>
        </div>
    </div>
</div>

<!-- view testimonial details -->
<ng-template #previewModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Testimonial Details</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>

    <div class="modal-body">
        <div class="row gy-3">

            <div class="col-12">
                <strong>Name :</strong>
                <div class="text-wrap mt-1">{{ viewTestimonial?.name || '-' }}</div>
            </div>
            <div class="col-md-6">
                <strong>Rating:</strong>
                <div class="mt-1">
                    <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                        <i class="mdi mdi-star"
                            [ngClass]="star <= viewTestimonial?.rating ? 'text-warning' : 'text-muted'"></i>
                    </ng-container>
                    <span class="ms-2">({{ viewTestimonial?.rating || '-' }})</span>
                </div>
            </div>

            <div class="col-md-6">
                <strong>Status:</strong>
                <div class="mt-1">
                    <span class="badge" [ngClass]="viewTestimonial?.isactive == 1 ? 'bg-success' : 'bg-secondary'">
                        {{ viewTestimonial?.isactive == 1 ? 'Active' : 'Inactive' }}
                    </span>
                </div>
            </div>

            <div class="col-12">
                <strong>Message:</strong>
                <div class="text-wrap mt-1">{{ viewTestimonial?.message || '-' }}</div>
            </div>

        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.close('Close click')">Close</button>
    </div>
</ng-template>